#!/usr/bin/env bash
set -e

DATABASE="$1"

case "$DATABASE" in
  mysql|mysql2|mariadb)
    bin/with-docker "$DATABASE" bundle exec rake test:mysql2
    ;;
  trilogy|trilogy-mysql|trilogy-mariadb)
    bin/with-docker "$DATABASE" bundle exec rake test:trilogy
    ;;
  postgres|postgresql)
    bin/with-docker "$DATABASE" bundle exec rake test:postgresql
    ;;
  sqlite|sqlite3)
    bin/with-docker "$DATABASE" bundle exec rake test:sqlite3
    ;;
  all)
    echo "Running all tests..."
    for database in sqlite3 postgresql mysql2 trilogy-mysql mariadb trilogy-mariadb; do
      echo "=== $database ==="
      "$0" "$database"
    done
    ;;
  *)
    echo "Unknown database target: $DATABASE"
    echo "Supported targets: mysql, mariadb, postgresql, sqlite3, trilogy-{mysql,mariadb}"
    exit 1
    ;;
esac
